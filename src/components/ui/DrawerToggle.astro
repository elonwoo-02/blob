---
// DrawerToggle.astro - Toggle button for opening/closing the drawer
---

<button
  class="drawer-toggle-btn absolute top-1/2 -translate-y-1/2 left-0 z-50 p-2.5 hover:bg-base-200 text-base-content/40 hover:text-base-content/70 rounded-xl transition-all duration-300 hidden"
  aria-label="Toggle Sidebar"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="w-5 h-5"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="1.8"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <!-- Sidebar Layout Icon -->
    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke-width="1.8"
    ></rect>
    <line x1="9" y1="3" x2="9" y2="21" stroke-width="1.8"></line>
  </svg>
</button>

<script>
  // Use a class selector to handle multiple instances of the toggle button
  const setupToggleButtons = () => {
    const toggleButtons = document.querySelectorAll(".drawer-toggle-btn");

    toggleButtons.forEach((btn) => {
      // Avoid duplicate listeners if this script runs multiple times
      if (btn.getAttribute("data-has-listener")) return;

      btn.addEventListener("click", () => {
        window.dispatchEvent(new CustomEvent("toggle-drawer"));
      });
      btn.setAttribute("data-has-listener", "true");
    });
  };

  // Listen for drawer state changes to hide/show all toggle buttons
  window.addEventListener("drawer-state-changed", (event: any) => {
    const { isOpen } = event.detail;
    const toggleButtons = document.querySelectorAll(".drawer-toggle-btn");

    toggleButtons.forEach((btn) => {
      if (isOpen) {
        btn.classList.add("hidden");
      } else {
        btn.classList.remove("hidden");
      }
    });
  });

  // Run on initial load and handle potential dynamic content
  setupToggleButtons();

  // Also re-run when content might have changed (e.g. view switching if dynamic)
  window.addEventListener("view-changed", () => {
    setTimeout(setupToggleButtons, 0);
  });
</script>
