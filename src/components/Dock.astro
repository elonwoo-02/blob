---
// src/components/Dock.astro
interface NavItem {
  title: string;
  link: string;
  icon?: string;
}

interface Props {
  leftNav?: NavItem[];
  rightApps?: NavItem[];
}

const { 
  leftNav = [
    { title: 'é¦–é¡µ', link: '/', icon: 'ğŸ ' },
    { title: 'åšå®¢', link: '/blog', icon: 'ğŸ“' },
    { title: 'å…³äº', link: '/about', icon: 'ğŸ‘¤' }
  ], 
  rightApps = [
    { title: 'GitHub', link: 'https://github.com', icon: 'ğŸ™' }
  ] 
} = Astro.props;

import DockItem from './DockItem.astro';
---

<!-- è§¦å‘åŒºåŸŸï¼šç”¨äºé¼ æ ‡è§¦åº•å‘¼å‡º -->
<div id="dock-trigger" class="fixed bottom-0 left-0 w-full h-4 z-[49]"></div>

<!-- Dock ä¸»ä½“ -->
<div id="dock-container" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 transition-all duration-500 ease-in-out">
  <div class="flex items-center gap-2 p-2 rounded-2xl bg-white/10 dark:bg-black/20 backdrop-blur-xl border border-white/20 shadow-2xl">
    
    <!-- å·¦ä¾§ç³»ç»Ÿå¯¼èˆª -->
    <div class="flex items-center px-1">
      {leftNav.map(item => (
        <DockItem href={item.link} label={item.title} />
      ))}
    </div>

    <!-- ä¸­ç«–çº¿ -->
    <div class="w-[1px] h-8 bg-white/20 mx-1"></div>

    <!-- å³ä¾§åŠ¨æ€å†…å®¹ -->
    <div class="flex items-center px-1">
      {rightApps.map(item => (
        <DockItem href={item.link} label={item.title} isExternal={item.link.startsWith('http')} />
      ))}
    </div>
  </div>
</div>

<script>
  const dock = document.getElementById('dock-container');
  const trigger = document.getElementById('dock-trigger');
  let hideTimeout: ReturnType<typeof setTimeout>;

  const showDock = () => {
    if (dock) {
      dock.style.transform = 'translateX(-50%) translateY(0)';
      dock.style.opacity = '1';
      resetHideTimer();
    }
  };

  const hideDock = () => {
    if (dock) {
      dock.style.transform = 'translateX(-50%) translateY(120%)';
      dock.style.opacity = '0';
    }
  };

  const resetHideTimer = () => {
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideDock, 3000);
  };

  // åˆå§‹åŒ–
  if (dock && trigger) {
    // é¼ æ ‡è¿›å…¥ Dock åŒºåŸŸï¼Œæ˜¾ç¤ºå¹¶é‡ç½®è®¡æ—¶å™¨
    dock.addEventListener('mouseenter', () => {
      clearTimeout(hideTimeout);
      showDock();
    });

    // é¼ æ ‡ç¦»å¼€ Dock åŒºåŸŸï¼Œå¼€å§‹ 3 ç§’å€’è®¡æ—¶
    dock.addEventListener('mouseleave', resetHideTimer);

    // é¼ æ ‡ç§»åŠ¨åˆ°è§¦å‘åŒºåŸŸï¼ˆå±å¹•åº•éƒ¨ï¼‰ï¼Œå‘¼å‡º Dock
    trigger.addEventListener('mouseenter', showDock);
    
    // å…¨å±€é¼ æ ‡ç§»åŠ¨ç›‘æ§ï¼Œå¦‚æœé è¿‘åº•éƒ¨ä¹Ÿæ˜¾ç¤º
    document.addEventListener('mousemove', (e) => {
      if (window.innerHeight - e.clientY < 50) {
        showDock();
      }
    });

    // åˆå§‹ 3 ç§’åè‡ªåŠ¨éšè—
    resetHideTimer();
  }
</script>

<style>
  #dock-container {
    /* åˆå§‹çŠ¶æ€ */
    will-change: transform, opacity;
  }
  
  /* ç¡®ä¿å›¾æ ‡åœ¨ Dock å†…éƒ¨ä¸ä¼šè¢«æˆªæ–­ */
  .flex {
    align-items: flex-end;
  }
</style>
