---
import type { TagNode } from "../../utils/tags";

interface Props {
  node: TagNode;
}

const { node } = Astro.props;
---

<li>
  <li>
    <div
      class="tag-item group flex items-center w-full px-3 py-1.5 rounded-lg transition-all duration-200 hover:bg-base-200/50 text-base-content/70 cursor-pointer user-select-none select-none relative"
      data-tag-group={node.name}
    >
      <!-- 1. Hashtag Icon -->
      <span class="text-base-content/30 mr-2 group-[.tag-active]:text-white/70">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-4 h-4"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M9.243 3.03a1 1 0 01.727 1.213L9.53 6h2.94l.56-2.243a1 1 0 111.94.486L14.53 6H17a1 1 0 110 2h-2.97l-1 4H15a1 1 0 110 2h-2.47l-.56 2.242a1 1 0 11-1.94-.485L10.47 14H7.53l-.56 2.242a1 1 0 11-1.94-.485L5.47 14H3a1 1 0 110-2h2.97l1-4H5a1 1 0 110-2h2.47l.56-2.243a1 1 0 011.213-.727zM9.03 8l-1 4h2.938l1-4H9.031z"
            clip-rule="evenodd"></path>
        </svg>
      </span>

      <!-- 2. Tag Name (Text) -->
      <span
        class="tag-nav-btn font-medium text-[15px] truncate"
        data-tag={node.name}
        data-tag-slug={node.slug}
      >
        {node.name}
      </span>

      <!-- 3. Toggle Arrow (If children) -->
      {
        node.children.length > 0 && (
          <button
            type="button"
            class="tag-toggle ml-1 p-0.5 rounded text-base-content/40 hover:bg-base-300/50 transition-colors z-10"
            data-expanded="true"
            aria-expanded="true"
            aria-label={`Toggle ${node.name}`}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-3.5 h-3.5 transition-transform duration-200"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        )
      }

      <!-- Spacer -->
      <div class="flex-1"></div>

      <!-- 4. Menu Icon (...) - Visible on Hover/Active -->
      <button
        class="opacity-0 group-hover:opacity-100 group-[.tag-active]:opacity-100 p-1 rounded text-base-content/40 hover:text-base-content/70 hover:bg-base-300/50 transition-all"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"
          ></path>
        </svg>
      </button>
    </div>
  </li>

  {
    node.children.length > 0 && (
      <ul class="tag-children ml-5 pl-2 border-l-2 border-base-200/50 mt-1 space-y-1">
        {node.children.map((child: TagNode) => (
          <Astro.self node={child} />
        ))}
      </ul>
    )
  }

  <style>
    /* Active State - Flomo Green */
    :global(.tag-active) {
      background-color: #508fa3 !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(80, 143, 163, 0.3);
    }

    :global(.tag-active) .tag-toggle {
      color: white;
      background-color: rgba(255, 255, 255, 0.2);
    }

    :global(.tag-active) .tag-toggle:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    :global(.tag-active) span {
      color: rgba(255, 255, 255, 0.8) !important;
    }

    :global(.tag-active) .opacity-30 {
      opacity: 0.6;
    }
  </style>
</li>
