---
// DrawerSidebar.astro - Main drawer sidebar container
import HeatmapSection from "../heatmap/HeatmapSection.astro";
---

<aside
  id="drawer-sidebar"
  class="drawer-sidebar fixed top-0 left-0 h-screen w-80 z-40 overflow-y-auto ml-[-320px]"
  style="transition: margin-left 500ms cubic-bezier(0.4, 0, 0.2, 1);"
>
  <div class="drawer-content flex flex-col h-full">
    <!-- Header -->
    <div class="drawer-header p-4 flex justify-between items-center">
      <h2 class="text-lg font-bold"></h2>
      <button
        id="drawer-close"
        class="btn btn-sm btn-circle btn-ghost"
        aria-label="Close Sidebar"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Sections -->
    <div class="drawer-body flex-1 overflow-y-auto">
      <HeatmapSection />
    </div>
  </div>
</aside>

<script>
  const drawer = document.getElementById("drawer-sidebar");
  const closeButton = document.getElementById("drawer-close");

  let isOpen = false;

  function toggleDrawer() {
    isOpen = !isOpen;

    if (isOpen) {
      drawer?.style.setProperty("margin-left", "0");
    } else {
      drawer?.style.setProperty("margin-left", "-320px");
    }

    // Dispatch event to notify content area to adjust
    const event = new CustomEvent("drawer-state-changed", {
      detail: { isOpen },
    });
    window.dispatchEvent(event);
  }

  // Listen for toggle event from DrawerToggle
  window.addEventListener("toggle-drawer", toggleDrawer);

  // Close drawer when clicking close button
  closeButton?.addEventListener("click", toggleDrawer);
</script>

<style>
  .drawer-sidebar {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--bc) / 0.2) transparent;
  }

  .drawer-sidebar::-webkit-scrollbar {
    width: 6px;
  }

  .drawer-sidebar::-webkit-scrollbar-track {
    background: transparent;
  }

  .drawer-sidebar::-webkit-scrollbar-thumb {
    background-color: hsl(var(--bc) / 0.2);
    border-radius: 3px;
  }

  .drawer-sidebar::-webkit-scrollbar-thumb:hover {
    background-color: hsl(var(--bc) / 0.3);
  }
</style>
