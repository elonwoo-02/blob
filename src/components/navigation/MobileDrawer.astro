---
import MenuIcon from '../icons/MenuIcon.astro';
import ThemeToggle from '../shared/ThemeToggle.astro';

const { pageTitle = 'Dimensional Debris' } = Astro.props;
const currentPath = Astro.url.pathname;
const navItems = [
  { href: '/', label: 'Home' },
  { href: '/blog/', label: 'Blog' },
  { href: '/about/', label: 'About' },
  { href: '/', label: 'Bot'}
];

---

<div class="drawer md:hidden">
  <input id="mobile-nav-drawer" type="checkbox" class="drawer-toggle" />

  <div class="drawer-content">
    <div class="navbar fixed top-0 left-0 z-50 w-full border-b border-base-200 bg-base-100/90 backdrop-blur-md">
      <div class="navbar-start flex items-center gap-2">
        <label for="mobile-nav-drawer" aria-label="open sidebar" class="btn btn-square btn-ghost">
          <MenuIcon />
        </label>
        <a href="/" class="font-bold truncate max-w-[42vw]">{pageTitle}</a>
      </div>

      <div class="navbar-end">
        <ThemeToggle />
      </div>
    </div>
  </div>

  <div class="drawer-side z-[60]">
    <label for="mobile-nav-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
    <ul class="menu min-h-full w-64 bg-base-200 p-4">
      <li class="menu-title">Navbar</li>
  {navItems.map((item) => (
    <li>
      <a href={item.href} data-nav-path={item.href}>
        {item.label}
      </a>
    </li>
  ))}
      <li><a href="https://github.com/elonwoo-02/" target="_blank" rel="noreferrer">GitHub</a></li>
    </ul>
  </div>
</div>

<script>
  const isFileScheme = window.location.protocol === 'file:' || window.location.origin === 'null';
  if (isFileScheme) {
    const base = window.location.href.replace(/[^/]*$/, '');
    const links = document.querySelectorAll('[data-nav-path]');
    links.forEach((link) => {
      const rawPath = link.getAttribute('data-nav-path') || '';
      if (!rawPath || rawPath.startsWith('http')) return;
      const normalized = rawPath.startsWith('/') ? rawPath.slice(1) : rawPath;
      link.setAttribute('href', new URL(normalized, base).toString());
    });
  }
</script>

<!-- Menu behavior -->
<script>
  const menu = document.querySelector('.menu');

  menu?.addEventListener('click', () => {
      const isExpanded = menu.getAttribute('aria-expanded') === 'true';
      menu.setAttribute('aria-expanded', `${!isExpanded}`);
  });
</script>

