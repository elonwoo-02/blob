---
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";
import Dock from "../components/dock/ui/Dock.astro";
import PlayBot from "../components/shared/bot/PlayBot.astro";
import Footer from "../components/shared/Footer.astro";
import TerminalModal from "../components/shared/terminal/TerminalModal.astro";
import Mobile from "../components/mobile/Mobile.astro";
import DynamicIslandShell from "../components/shared/dynamic-island/DynamicIslandShell.astro";

interface Props {
  pageTitle?: string;
  contentWidth?: "5xl" | "6xl" | "7xl" | "full";
  contentClass?: string;
  mainClass?: string;
  showElonFloat?: boolean;
}

const {
  pageTitle = "",
  contentWidth = "6xl",
  contentClass = "",
  mainClass = "",
  showElonFloat = true,
} = Astro.props as Props;

const contentWidthClassMap = {
  "5xl": "max-w-5xl",
  "6xl": "max-w-6xl",
  "7xl": "max-w-7xl",
  full: "max-w-none",
} as const;

const contentWidthClass = contentWidthClassMap[contentWidth] ?? "max-w-6xl";
---

<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/icon_favicon32x32.png"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <ClientRouter />
    <title>{pageTitle}</title>
  </head>

  <body class="tracking-wide text-base-content flex flex-col">
    <!-- Global navigation -->
    <Mobile />
    <Dock pageTitle={pageTitle} currentPath={Astro.url.pathname} />
    <DynamicIslandShell />

    <!-- Terminal entry shell: mount point only, terminal internals stay in TerminalModal -->
    <div
      id="shortcut-overlay"
      class="shortcut-overlay rounded-xl fixed inset-0 z-40 hidden flex items-center justify-center bg-[rgba(5,8,12,0.55)] backdrop-blur-sm"
      aria-hidden="true"
    >
      <TerminalModal />
    </div>

    <!-- Main content -->
    <main class={`w-full flex-1 ${mainClass}`.trim()}>
      <div class={`site-content w-full mx-auto px-4 sm:px-6 lg:px-8 ${contentWidthClass} ${contentClass}`.trim()}>
        <slot />
      </div>
    </main>

    <!--Global footer -->
    <Footer />

    <!-- TODO: Add AIbot command to route AI assistant interactions via terminal. -->
    {showElonFloat && (
      <div
        id="elon-bot"
        class="hidden md:block fixed left-0 bottom-0 z-70 w-50 h-50"
      >
        <PlayBot />
      </div>
    )}

    <script>
      import "../scripts/globalShortcuts.js";
      import { registerAppServiceWorker } from "../scripts/registerSw";

      registerAppServiceWorker();
    </script>
  </body>
</html>
