---
import '../styles/global.css';
import Dock from "../components/dock/ui/Dock.astro";
import PlayBot from "../components/bot/PlayBot.astro";
import MobileDrawer from "../components/navigation/MobileDrawer.astro";
import Footer from "../components/shared/Footer.astro";
import TerminalModal from "../components/terminal/TerminalModal.astro";

const {
  pageTitle,
  mainClass = 'pt-10 md:pt-8',
} = Astro.props;
---

<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icon_favicon32x32.png" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="viewport" content="width=device-width" />
  <meta name="generator" content={Astro.generator} />
  <title>{pageTitle}</title>
</head>

<body class="min-h-screen bg-base-100 text-base-content pb-24">
  <div id="app-launch-splash" class="app-launch-splash hidden" aria-hidden="true">
    <p class="app-launch-text">Holy, Elon</p>
  </div>

  <!-- Global navigation -->
  <MobileDrawer pageTitle={pageTitle} />
  <Dock pageTitle={pageTitle} currentPath={Astro.url.pathname} />

  <!-- Terminal entry shell: mount point only, terminal internals stay in TerminalModal -->
  <div id="shortcut-overlay" class="shortcut-overlay fixed inset-0 z-40 hidden flex items-center justify-center bg-[rgba(5,8,12,0.55)] backdrop-blur-sm" aria-hidden="true">
    <TerminalModal />
  </div>

  <!-- Main content -->
  <main class={`container mx-auto px-4 py-4 ${mainClass}`}>
    <h1 class="text-4xl font-bold mb-8">{pageTitle}</h1>
    <slot />
  </main>

  <!-- Global footer -->
  <Footer />

  <!-- TODO: Add AIbot command to route AI assistant interactions via terminal. -->
  <div id="elon-bot" class="hidden md:block fixed left-0 bottom-0 z-70 w-50 h-50">
    <PlayBot />
  </div>
  <script>
    import "../scripts/capacitor-runtime.js";
    import "../scripts/globalShortcuts.js";

    const splash = document.getElementById('app-launch-splash');
    const isCapacitorRuntime = typeof window !== 'undefined' && 'Capacitor' in window;
    const isFileLike = window.location.protocol === 'file:' ||
      window.location.origin === 'null' ||
      window.location.href.includes('/android_asset/');

    if (splash && isCapacitorRuntime && isFileLike) {
      splash.classList.remove('hidden');
      requestAnimationFrame(() => splash.classList.add('is-visible'));

      window.setTimeout(() => {
        splash.classList.remove('is-visible');
        splash.classList.add('is-leaving');
      }, 1050);

      window.setTimeout(() => {
        splash.remove();
      }, 1500);
    }
  </script>

  <style is:inline>
    .app-launch-splash {
      position: fixed;
      inset: 0;
      z-index: 99999;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 35% 22%, rgba(16, 185, 129, 0.16), transparent 58%), #08100d;
      opacity: 0;
      transition: opacity 260ms ease;
      pointer-events: none;
    }

    .app-launch-splash.hidden {
      display: none;
    }

    .app-launch-splash.is-visible {
      opacity: 1;
    }

    .app-launch-splash.is-leaving {
      opacity: 0;
    }

    .app-launch-text {
      margin: 0;
      color: #d1fae5;
      font-family: 'Georgia', 'Times New Roman', serif;
      font-size: clamp(2rem, 6.2vw, 3.4rem);
      font-style: italic;
      letter-spacing: 0.08em;
      text-shadow: 0 0 14px rgba(52, 211, 153, 0.38), 0 0 42px rgba(16, 185, 129, 0.18);
      transform: translateY(6px);
      opacity: 0;
      animation: app-launch-rise 560ms ease-out 120ms forwards;
    }

    @keyframes app-launch-rise {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>
</body>
</html>



